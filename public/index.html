<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brandynette Video Player - Port 6969</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">

  <!-- Modern CSS Architecture - Load in correct cascade layer order -->
  <link rel="stylesheet" href="/css/layers.css">      <!-- 1. Define cascade layers -->
  <link rel="stylesheet" href="/css/variables.css">   <!-- 2. Design tokens -->
  <link rel="stylesheet" href="/css/reset.css">       <!-- 3. CSS reset + base -->
  <link rel="stylesheet" href="/css/layout.css">      <!-- 4. App layout -->
  <link rel="stylesheet" href="/css/components.css">  <!-- 5. UI components -->
  <link rel="stylesheet" href="/css/features.css">    <!-- 6. Feature styles -->

  <style>
    /* Component-specific overrides (minimal inline styles) */
    .video-name {
      font-size: 0.65rem;
      opacity: 0.8;
      margin: 0;
      padding: 0;
    }

    .video-title {
      font-size: 0.8rem;
      margin: 0;
      padding: 0;
    }

    /* Neon Cyber Goth Scrolling Ticker Animation */
    @keyframes scroll-left {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }
  </style>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Queue Modal Component
    function QueueModal({ onAccessGranted }) {
      const [queueState, setQueueState] = useState('initial'); // initial, joining, queued, active, error
      const [ticketData, setTicketData] = useState(null);
      const [countdown, setCountdown] = useState(0);
      const [queueStatus, setQueueStatus] = useState(null);
      const [error, setError] = useState(null);
      const ticketIdRef = useRef(null);

      // Join queue on mount
      useEffect(() => {
        const joinQueue = async () => {
          setQueueState('joining');
          try {
            console.log('Joining queue...');
            const response = await fetch('/api/queue/join', { method: 'POST' });
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            console.log('Queue response:', data);
            
            ticketIdRef.current = data.ticketId;
            setTicketData(data);
            
            if (data.status === 'granted') {
              console.log('Access granted immediately');
              setQueueState('active');
              setCountdown(0);
              setTimeout(() => onAccessGranted(data.ticketId), 1000);
            } else {
              console.log('Added to queue, position:', data.position);
              setQueueState('queued');
              setCountdown(data.waitTime);
            }
          } catch (err) {
            console.error('Error joining queue:', err);
            setError('Failed to join queue. Please refresh.');
            setQueueState('error');
          }
        };

        joinQueue();
      }, [onAccessGranted]);

      // Poll ticket status when queued
      useEffect(() => {
        if (queueState !== 'queued' || !ticketIdRef.current) return;

        const checkTicket = async () => {
          try {
            const response = await fetch(`/api/queue/check/${ticketIdRef.current}`);
            const data = await response.json();
            
            if (data.status === 'active') {
              setQueueState('active');
              setCountdown(0);
              setTimeout(() => onAccessGranted(data.ticketId), 1000);
            } else if (data.status === 'queued') {
              setCountdown(data.waitTime);
              setTicketData(data);
            } else if (data.status === 'expired') {
              setError('Ticket expired. Please refresh.');
              setQueueState('error');
            }
          } catch (err) {
            console.error('Error checking ticket:', err);
          }
        };

        const interval = setInterval(checkTicket, 1000);
        return () => clearInterval(interval);
      }, [queueState, onAccessGranted]);

      // Countdown timer - decrements every second
      useEffect(() => {
        if (queueState !== 'queued' || countdown <= 0) return;

        const timer = setInterval(() => {
          setCountdown(prev => Math.max(0, prev - 1));
        }, 1000);

        return () => clearInterval(timer);
      }, [queueState, countdown]);

      // Fetch queue status for display
      useEffect(() => {
        const fetchQueueStatus = async () => {
          try {
            const response = await fetch('/api/queue/status');
            const data = await response.json();
            setQueueStatus(data);
          } catch (err) {
            console.error('Error fetching queue status:', err);
          }
        };

        fetchQueueStatus();
        const interval = setInterval(fetchQueueStatus, 3000);
        return () => clearInterval(interval);
      }, []);

      return React.createElement('div', {
        style: {
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundColor: 'rgba(0, 0, 0, 0.95)',
          backdropFilter: 'blur(10px)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 9999,
          padding: '1rem'
        }
      },
        React.createElement('div', {
          className: 'glass-bubble glow-effect',
          style: {
            maxWidth: '600px',
            width: '100%',
            padding: '2rem',
            textAlign: 'center'
          }
        },
          // Header
          React.createElement('h1', {
            style: {
              color: 'var(--button-color)',
              marginBottom: '1rem',
              fontSize: '2rem',
              textShadow: '0 0 20px var(--glow-pink)'
            }
          }, '\ud83c\udfab Queue System'),

          // Loading State
          queueState === 'joining' && React.createElement('div', null,
            React.createElement('div', {
              style: {
                width: '50px',
                height: '50px',
                border: '4px solid var(--glass-border)',
                borderTop: '4px solid var(--button-color)',
                borderRadius: '50%',
                animation: 'spin 1s linear infinite',
                margin: '2rem auto'
              }
            }),
            React.createElement('p', {
              style: { color: 'var(--primary-alt)', fontSize: '1.2rem' }
            }, 'Joining queue...')
          ),

          // Queued State
          queueState === 'queued' && ticketData && React.createElement('div', null,
            React.createElement('div', {
              style: {
                fontSize: '4rem',
                color: 'var(--secondary-alt)',
                marginBottom: '1rem'
              }
            }, countdown > 0 ? countdown : '\u23f3'),
            
            React.createElement('h2', {
              style: { color: 'var(--nav-alt)', marginBottom: '1rem' }
            }, countdown > 0 ? `Wait ${countdown} seconds` : 'Almost ready...'),
            
            React.createElement('div', {
              className: 'glass-bubble',
              style: {
                padding: '1rem',
                marginTop: '1.5rem',
                background: 'rgba(255, 0, 255, 0.1)'
              }
            },
              React.createElement('p', {
                style: { color: 'var(--tertiary-alt)', fontSize: '0.9rem', marginBottom: '0.5rem' }
              }, '\ud83c\udfab Your Ticket'),
              React.createElement('p', {
                style: { 
                  color: 'var(--button-color)', 
                  fontFamily: 'monospace', 
                  fontSize: '0.8rem',
                  wordBreak: 'break-all'
                }
              }, ticketData.ticketId),
              React.createElement('p', {
                style: { color: 'var(--primary-alt)', fontSize: '1.2rem', marginTop: '1rem' }
              }, `Position in queue: #${ticketData.position}`)
            ),

            queueStatus && React.createElement('div', {
              style: {
                marginTop: '1.5rem',
                padding: '1rem',
                borderTop: '1px solid var(--glass-border)'
              }
            },
              React.createElement('p', {
                style: { color: 'var(--nav-color)', fontSize: '0.85rem' }
              }, `\ud83d\udc65 Active viewers: ${queueStatus.active}/${queueStatus.maxConcurrent}`),
              React.createElement('p', {
                style: { color: 'var(--nav-color)', fontSize: '0.85rem' }
              }, `\u23f3 Waiting in queue: ${queueStatus.waiting}`)
            )
          ),

          // Active State
          queueState === 'active' && React.createElement('div', null,
            React.createElement('div', {
              style: {
                fontSize: '4rem',
                marginBottom: '1rem'
              }
            }, '\u2705'),
            React.createElement('h2', {
              style: { color: 'var(--tertiary-alt)', marginBottom: '1rem' }
            }, 'Access Granted!'),
            React.createElement('p', {
              style: { color: 'var(--primary-alt)' }
            }, 'Loading content...')
          ),

          // Error State
          queueState === 'error' && React.createElement('div', null,
            React.createElement('div', {
              style: {
                fontSize: '4rem',
                color: 'var(--error)',
                marginBottom: '1rem'
              }
            }, '\u274c'),
            React.createElement('h2', {
              style: { color: 'var(--error)', marginBottom: '1rem' }
            }, 'Error'),
            React.createElement('p', {
              style: { color: 'var(--primary-alt)', marginBottom: '1.5rem' }
            }, error || 'Something went wrong'),
            React.createElement('button', {
              className: 'bubble-button',
              onClick: () => window.location.reload(),
              style: { padding: '0.8rem 1.5rem' }
            }, 'Refresh Page')
          ),

          // Footer note
          queueState === 'queued' && React.createElement('div', {
            style: {
              marginTop: '2rem',
              padding: '1rem',
              borderTop: '1px solid var(--glass-border)',
              fontSize: '0.75rem',
              color: 'var(--nav-color)',
              opacity: 0.7
            }
          },
            React.createElement('p', null, '\ud83d\udca1 Future: Premium members skip the queue'),
            React.createElement('p', null, 'Stripe \u2022 Patreon \u2022 BambiCloud')
          )
        )
      );
    }

    // Metronome Component
    function Metronome() {
      const [isPlaying, setIsPlaying] = useState(false);
      const [bpm, setBpm] = useState(60);
      const [beat, setBeat] = useState(0);
      const [soundEnabled, setSoundEnabled] = useState(false);
      const intervalRef = useRef(null);
      const audioContextRef = useRef(null);

      useEffect(() => {
        // Initialize Web Audio API
        if (typeof window !== 'undefined' && window.AudioContext) {
          audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
        }

        return () => {
          if (audioContextRef.current) {
            audioContextRef.current.close();
          }
        };
      }, []);

      useEffect(() => {
        if (isPlaying) {
          const interval = 60000 / bpm; // Convert BPM to milliseconds
          intervalRef.current = setInterval(() => {
            setBeat(prev => (prev + 1) % 4);
            if (soundEnabled && audioContextRef.current) {
              playClick();
            }
          }, interval);
        } else {
          if (intervalRef.current) {
            clearInterval(intervalRef.current);
          }
          setBeat(0);
        }

        return () => {
          if (intervalRef.current) {
            clearInterval(intervalRef.current);
          }
        };
      }, [isPlaying, bpm, soundEnabled]);

      const playClick = () => {
        const ctx = audioContextRef.current;
        if (!ctx) return;

        const oscillator = ctx.createOscillator();
        const gainNode = ctx.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(ctx.destination);

        // Higher pitch for beat 0, lower for others
        oscillator.frequency.value = beat === 0 ? 1000 : 800;
        oscillator.type = 'sine';

        gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);

        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + 0.1);
      };

      const togglePlay = () => {
        setIsPlaying(!isPlaying);
      };

      const handleBpmChange = (e) => {
        const newBpm = parseInt(e.target.value);
        setBpm(newBpm);
      };

      const adjustBpm = (delta) => {
        setBpm(prev => Math.max(30, Math.min(240, prev + delta)));
      };

      return React.createElement('div', {
        className: 'glass-bubble compact-container',
        style: {
          position: 'fixed',
          bottom: '20px',
          right: '20px',
          padding: '1rem',
          minWidth: '280px',
          background: 'linear-gradient(135deg, rgba(23, 219, 216, 0.15), rgba(2, 184, 147, 0.15))',
          border: '2px solid rgba(23, 219, 216, 0.5)',
          boxShadow: isPlaying 
            ? '0 0 30px rgba(23, 219, 216, 0.6), 0 0 60px rgba(0, 255, 255, 0.4)'
            : '0 0 20px rgba(23, 219, 216, 0.3)',
          zIndex: 1000,
          transition: 'all 0.3s ease'
        }
      },
        React.createElement('div', {
          style: {
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'space-between',
            marginBottom: '1rem'
          }
        },
          React.createElement('h3', {
            style: {
              margin: 0,
              fontSize: '1rem',
              color: 'var(--nav-alt)',
              textShadow: '0 0 10px var(--glow-cyan)',
              fontWeight: 'bold'
            }
          }, 'üéµ Metronome'),
          React.createElement('div', {
            style: {
              display: 'flex',
              gap: '0.5rem'
            }
          },
            // Visual beat indicators
            [0, 1, 2, 3].map(i =>
              React.createElement('div', {
                key: i,
                style: {
                  width: '12px',
                  height: '12px',
                  borderRadius: '50%',
                  background: beat === i && isPlaying
                    ? 'var(--glow-cyan)'
                    : 'rgba(255, 255, 255, 0.2)',
                  boxShadow: beat === i && isPlaying
                    ? '0 0 15px var(--glow-cyan), 0 0 30px var(--glow-cyan)'
                    : 'none',
                  transition: 'all 0.1s ease',
                  border: i === 0 ? '2px solid var(--button-color)' : '1px solid rgba(255, 255, 255, 0.3)'
                }
              })
            )
          )
        ),

        // BPM Display
        React.createElement('div', {
          style: {
            textAlign: 'center',
            marginBottom: '1rem'
          }
        },
          React.createElement('div', {
            style: {
              fontSize: '2.5rem',
              fontWeight: 'bold',
              color: 'var(--glow-cyan)',
              textShadow: '0 0 20px var(--glow-cyan)',
              fontFamily: 'monospace',
              marginBottom: '0.25rem'
            }
          }, bpm),
          React.createElement('div', {
            style: {
              fontSize: '0.8rem',
              color: 'var(--primary-alt)',
              opacity: 0.9
            }
          }, 'BPM')
        ),

        // BPM Controls
        React.createElement('div', {
          style: {
            display: 'flex',
            gap: '0.5rem',
            marginBottom: '1rem',
            alignItems: 'center'
          }
        },
          React.createElement('button', {
            onClick: () => adjustBpm(-10),
            className: 'bubble-button',
            style: {
              padding: '0.5rem 0.75rem',
              fontSize: '1rem',
              minWidth: 'auto',
              background: 'rgba(223, 4, 113, 0.3)',
              border: '1px solid var(--button-color)'
            }
          }, '‚àí10'),
          React.createElement('button', {
            onClick: () => adjustBpm(-1),
            className: 'bubble-button',
            style: {
              padding: '0.5rem 0.75rem',
              fontSize: '1rem',
              minWidth: 'auto',
              background: 'rgba(223, 4, 113, 0.3)',
              border: '1px solid var(--button-color)'
            }
          }, '‚àí1'),
          React.createElement('input', {
            type: 'range',
            min: '30',
            max: '240',
            value: bpm,
            onChange: handleBpmChange,
            style: {
              flex: 1,
              accentColor: 'var(--glow-cyan)'
            }
          }),
          React.createElement('button', {
            onClick: () => adjustBpm(1),
            className: 'bubble-button',
            style: {
              padding: '0.5rem 0.75rem',
              fontSize: '1rem',
              minWidth: 'auto',
              background: 'rgba(223, 4, 113, 0.3)',
              border: '1px solid var(--button-color)'
            }
          }, '+1'),
          React.createElement('button', {
            onClick: () => adjustBpm(10),
            className: 'bubble-button',
            style: {
              padding: '0.5rem 0.75rem',
              fontSize: '1rem',
              minWidth: 'auto',
              background: 'rgba(223, 4, 113, 0.3)',
              border: '1px solid var(--button-color)'
            }
          }, '+10')
        ),

        // Play/Stop and Sound Toggle
        React.createElement('div', {
          style: {
            display: 'flex',
            gap: '0.5rem'
          }
        },
          React.createElement('button', {
            onClick: togglePlay,
            className: 'bubble-button',
            style: {
              flex: 1,
              padding: '0.75rem',
              fontSize: '1rem',
              fontWeight: 'bold',
              background: isPlaying 
                ? 'linear-gradient(135deg, rgba(223, 4, 113, 0.4), rgba(255, 0, 255, 0.4))'
                : 'linear-gradient(135deg, rgba(2, 184, 147, 0.3), rgba(23, 219, 216, 0.3))',
              border: isPlaying ? '2px solid var(--button-color)' : '2px solid var(--nav-alt)',
              boxShadow: isPlaying
                ? '0 0 20px rgba(223, 4, 113, 0.6)'
                : '0 0 15px rgba(23, 219, 216, 0.5)'
            }
          }, isPlaying ? '‚è∏ Stop' : '‚ñ∂ Start'),
          React.createElement('button', {
            onClick: () => setSoundEnabled(!soundEnabled),
            className: 'bubble-button',
            style: {
              padding: '0.75rem 1rem',
              fontSize: '1rem',
              background: soundEnabled
                ? 'rgba(138, 43, 226, 0.3)'
                : 'rgba(0, 0, 0, 0.3)',
              border: soundEnabled ? '2px solid var(--glow-purple)' : '1px solid rgba(255, 255, 255, 0.3)',
              boxShadow: soundEnabled ? '0 0 15px rgba(138, 43, 226, 0.5)' : 'none'
            }
          }, soundEnabled ? 'üîä' : 'üîá')
        ),

        // Tempo presets
        React.createElement('div', {
          style: {
            marginTop: '1rem',
            display: 'flex',
            gap: '0.5rem',
            flexWrap: 'wrap',
            justifyContent: 'center'
          }
        },
          [
            { label: 'Slow', value: 60 },
            { label: 'Med', value: 120 },
            { label: 'Fast', value: 180 }
          ].map(preset =>
            React.createElement('button', {
              key: preset.label,
              onClick: () => setBpm(preset.value),
              className: 'bubble-button',
              style: {
                padding: '0.4rem 0.8rem',
                fontSize: '0.75rem',
                background: bpm === preset.value
                  ? 'rgba(138, 43, 226, 0.3)'
                  : 'rgba(0, 0, 0, 0.2)',
                border: bpm === preset.value
                  ? '1px solid var(--glow-purple)'
                  : '1px solid rgba(255, 255, 255, 0.2)',
                opacity: bpm === preset.value ? 1 : 0.7
              }
            }, preset.label)
          )
        )
      );
    }

    // Download Status Component
    function DownloadStatus() {
      const [status, setStatus] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const fetchStatus = async () => {
          try {
            const response = await fetch('/api/download-status');
            if (response.ok) {
              const data = await response.json();
              setStatus(data);
            }
          } catch (err) {
            console.error('Error fetching download status:', err);
          } finally {
            setLoading(false);
          }
        };

        // Initial fetch
        fetchStatus();

        // Poll every 2 seconds for updates
        const interval = setInterval(fetchStatus, 2000);

        return () => clearInterval(interval);
      }, []);

      if (loading || !status) {
        return null;
      }

      const hasActivity = status.stats.activeCount > 0 || status.stats.waitingCount > 0;

      if (!hasActivity) {
        return null; // Don't show if no downloads
      }

      return React.createElement('div', {
        className: 'glass-bubble glow-effect compact-container',
        style: {
          margin: '0.4rem',
          maxWidth: '1200px',
          marginLeft: 'auto',
          marginRight: 'auto'
        }
      },
        React.createElement('h3', {
          className: 'video-title',
          style: {
            textAlign: 'center',
            marginBottom: '1rem',
            color: 'var(--nav-alt)',
            fontSize: '1.2rem'
          }
        }, `üìä Download Status (${status.stats.activeCount}/${status.stats.maxConcurrent} Active)`),

        // Active Downloads
        status.stats.activeCount > 0 && React.createElement('div', {
          style: { marginBottom: '1rem' }
        },
          React.createElement('h4', {
            style: {
              color: 'var(--primary-alt)',
              fontSize: '0.9rem',
              marginBottom: '0.5rem'
            }
          }, 'üî• Currently Downloading:'),
          React.createElement('div', {
            className: 'glass-bubble',
            style: {
              padding: '0.5rem',
              background: 'rgba(0, 255, 255, 0.05)'
            }
          },
            status.active.map((download, index) =>
              React.createElement('div', {
                key: download.sessionId,
                style: {
                  padding: '0.3rem 0.5rem',
                  borderBottom: index < status.active.length - 1 ? '1px solid var(--glass-border)' : 'none',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }
              },
                React.createElement('span', {
                  style: {
                    color: 'var(--tertiary-alt)',
                    fontSize: '0.8rem',
                    fontWeight: 'bold'
                  }
                }, `üì• ${download.filename}`),
                React.createElement('span', {
                  style: {
                    color: 'var(--primary-alt)',
                    fontSize: '0.7rem',
                    opacity: 0.8
                  }
                }, `${download.duration}s`)
              )
            )
          )
        ),

        // Queue
        status.stats.waitingCount > 0 && React.createElement('div', null,
          React.createElement('h4', {
            style: {
              color: 'var(--secondary-alt)',
              fontSize: '0.9rem',
              marginBottom: '0.5rem'
            }
          }, `‚è≥ Queue (${status.stats.waitingCount} waiting):`),
          React.createElement('div', {
            className: 'glass-bubble',
            style: {
              padding: '0.5rem',
              background: 'rgba(255, 0, 255, 0.05)'
            }
          },
            status.waiting.map((item, index) =>
              React.createElement('div', {
                key: item.sessionId,
                style: {
                  padding: '0.3rem 0.5rem',
                  borderBottom: index < status.waiting.length - 1 ? '1px solid var(--glass-border)' : 'none',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }
              },
                React.createElement('span', {
                  style: {
                    color: 'var(--button-color)',
                    fontSize: '0.8rem'
                  }
                }, `#${item.position} - ${item.filename}`),
                React.createElement('span', {
                  style: {
                    color: 'var(--secondary-alt)',
                    fontSize: '0.7rem',
                    opacity: 0.8
                  }
                }, `waiting ${item.waitTime}s`)
              )
            )
          )
        )
      );
    }

    function VideoPlayer({ videoSrc, title }) {
      const [isPlaying, setIsPlaying] = useState(false);
      const [currentTime, setCurrentTime] = useState(0);
      const [duration, setDuration] = useState(0);
      const [volume, setVolume] = useState(1);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      const videoRef = React.useRef(null);

      useEffect(() => {
        const video = videoRef.current;
        if (!video) return;

        const handleLoadedMetadata = () => {
          setDuration(video.duration);
          setLoading(false);
        };

        const handleTimeUpdate = () => setCurrentTime(video.currentTime);
        const handlePlay = () => setIsPlaying(true);
        const handlePause = () => setIsPlaying(false);
        const handleEnded = () => setIsPlaying(false);
        const handleError = () => {
          setError('Failed to load video');
          setLoading(false);
        };

        video.addEventListener('loadedmetadata', handleLoadedMetadata);
        video.addEventListener('timeupdate', handleTimeUpdate);
        video.addEventListener('play', handlePlay);
        video.addEventListener('pause', handlePause);
        video.addEventListener('ended', handleEnded);
        video.addEventListener('error', handleError);

        return () => {
          video.removeEventListener('loadedmetadata', handleLoadedMetadata);
          video.removeEventListener('timeupdate', handleTimeUpdate);
          video.removeEventListener('play', handlePlay);
          video.removeEventListener('pause', handlePause);
          video.removeEventListener('ended', handleEnded);
          video.removeEventListener('error', handleError);
        };
      }, [videoSrc]);

      const togglePlay = () => {
        const video = videoRef.current;
        if (video.paused) {
          video.play();
        } else {
          video.pause();
        }
      };

      const handleSeek = (e) => {
        const video = videoRef.current;
        const rect = e.currentTarget.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        video.currentTime = percent * duration;
      };

      const handleVolumeChange = (e) => {
        const newVolume = parseFloat(e.target.value);
        setVolume(newVolume);
        videoRef.current.volume = newVolume;
      };

      const formatTime = (time) => {
        const minutes = Math.floor(time / 60);
        const seconds = Math.floor(time % 60);
        return `${minutes}:${seconds.toString().padStart(2, '0')}`;
      };

      if (error) {
        return React.createElement('div', { style: { color: 'red', padding: '2rem', textAlign: 'center' } }, error);
      }

      return React.createElement('div', {
        className: 'glass-bubble glow-effect',
        style: {
          padding: '0.8rem',
          margin: '0.4rem'
        }
      },
        React.createElement('div', {
          className: 'glass-bubble',
          style: { position: 'relative', background: 'black', overflow: 'hidden', margin: '0.3rem' }
        },
          React.createElement('video', {
            ref: videoRef,
            src: videoSrc,
            style: { width: '100%', height: 'auto', maxHeight: '70vh', display: 'block', cursor: 'pointer' },
            onClick: togglePlay
          }),
          loading && React.createElement('div', {
            style: {
              position: 'absolute',
              top: '50%',
              left: '50%',
              transform: 'translate(-50%, -50%)',
              color: 'white',
              textAlign: 'center'
            }
          }, 'Loading video...')
        ),
        React.createElement('div', {
          className: 'glass-bubble compact-container',
          style: {
            display: 'flex',
            alignItems: 'center',
            gap: '0.3rem',
            color: 'white'
          }
        },
          React.createElement('button', {
            onClick: togglePlay,
            disabled: loading,
            className: 'bubble-button glow-effect',
            style: {
              fontSize: '1.1rem'
            }
          }, isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'),
          React.createElement('div', {
            style: {
              flex: 1,
              height: '8px',
              background: 'var(--button-alt)',
              borderRadius: 'var(--border-radius)',
              cursor: 'pointer',
              border: '1px solid var(--nav-alt)'
            },
            onClick: handleSeek
          },
            React.createElement('div', {
              style: {
                height: '100%',
                background: 'linear-gradient(90deg, var(--tertiary-alt), var(--primary-alt))',
                width: `${(currentTime / duration) * 100}%`,
                borderRadius: 'var(--border-radius)',
                transition: 'width 0.1s ease'
              }
            })
          ),
          React.createElement('span', { style: { fontSize: '0.9rem', fontFamily: 'monospace', minWidth: '80px' } },
            `${formatTime(currentTime)} / ${formatTime(duration)}`
          ),
          React.createElement('span', null, 'üîä'),
          React.createElement('input', {
            type: 'range',
            min: '0',
            max: '1',
            step: '0.1',
            value: volume,
            onChange: handleVolumeChange,
            style: { width: '80px' }
          })
        ),
        React.createElement('div', {
          className: 'no-spacing',
          style: { textAlign: 'center' }
        },
          React.createElement('h3', {
            className: 'video-title glow-effect'
          }, title)
        )
      );
    }

    function App() {
      const [videos, setVideos] = useState([]);
      const [publicFiles, setPublicFiles] = useState([]);
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);
      const [selectedVideo, setSelectedVideo] = useState(null);
      const [hasAccess, setHasAccess] = useState(false);
      const [ticketId, setTicketId] = useState(null);

      useEffect(() => {
        if (hasAccess) {
          fetchData();
        }
      }, [hasAccess]);

      const handleAccessGranted = (ticket) => {
        setTicketId(ticket);
        setHasAccess(true);
      };

      const fetchData = async () => {
        try {
          setLoading(true);

          // Fetch videos
          const videosResponse = await fetch('/api/videos');
          if (!videosResponse.ok) throw new Error('Failed to fetch videos');
          const videosData = await videosResponse.json();
          setVideos(videosData.videos);

          // Fetch public files
          const publicResponse = await fetch('/api/public');
          if (!publicResponse.ok) throw new Error('Failed to fetch public files');
          const publicData = await publicResponse.json();
          setPublicFiles(publicData.files);

          // Auto-select first video
          if (videosData.videos.length > 0) {
            setSelectedVideo(videosData.videos[0]);
          }
        } catch (err) {
          console.error('Error fetching data:', err);
          setError('Failed to load data. Please try again.');
        } finally {
          setLoading(false);
        }
      };

      // Show queue modal if no access
      if (!hasAccess) {
        return React.createElement(QueueModal, { onAccessGranted: handleAccessGranted });
      }

      // Show loading after access granted
      if (loading) {
        return React.createElement('div', {
          style: {
            display: 'flex',
            flexDirection: 'column',
            alignItems: 'center',
            justifyContent: 'center',
            minHeight: '100vh',
            color: 'white',
            textAlign: 'center'
          }
        },
          React.createElement('div', {
            style: {
              width: '50px',
              height: '50px',
              border: '4px solid rgba(255,255,255,0.3)',
              borderTop: '4px solid white',
              borderRadius: '50%',
              animation: 'spin 1s linear infinite',
              marginBottom: '1rem'
            }
          }),
          React.createElement('p', null, 'Loading videos...')
        );
      }

      return React.createElement('div', { style: { minHeight: '100vh', color: 'white' } },
        React.createElement('header', {
          className: 'glass-bubble glow-effect',
          style: {
            textAlign: 'center',
            padding: '0.5rem',
            margin: '0.2rem'
          }
        },
          React.createElement('h1', {
            style: {
              margin: '0 0 0.5rem 0',
              fontSize: '2.5rem',
              fontWeight: '700',
              textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
              fontFamily: 'Audiowide, sans-serif',
              color: 'var(--nav-alt)',
              textTransform: 'uppercase',
              letterSpacing: '2px'
            }
          }, 'üé¨ Brandynette Video Player'),
          React.createElement('div', {
            style: {
              margin: '0.5rem 0',
              overflow: 'hidden',
              background: 'linear-gradient(90deg, rgba(0,0,0,0.8), rgba(138,43,226,0.3), rgba(0,0,0,0.8))',
              border: '2px solid var(--glow-purple)',
              borderRadius: '8px',
              padding: '0.5rem 0',
              boxShadow: '0 0 20px rgba(138,43,226,0.6), inset 0 0 20px rgba(255,0,255,0.2)'
            }
          },
            React.createElement('div', {
              style: {
                display: 'inline-block',
                whiteSpace: 'nowrap',
                animation: 'scroll-left 20s linear infinite',
                fontSize: '1rem',
                fontWeight: 'bold',
                fontFamily: 'Audiowide, sans-serif',
                background: 'linear-gradient(90deg, var(--glow-cyan), var(--glow-pink), var(--glow-purple), var(--glow-cyan))',
                backgroundSize: '200% 100%',
                WebkitBackgroundClip: 'text',
                WebkitTextFillColor: 'transparent',
                backgroundClip: 'text',
                textShadow: 'none',
                filter: 'drop-shadow(0 0 8px var(--glow-cyan)) drop-shadow(0 0 12px var(--glow-pink))'
              }
            }, '‚ö° BREAKING: Premium video streaming NOW LIVE on port 6969 ‚ö° Unlimited concurrent viewers ‚ö° Browser-cached playback ‚ö° Download queue: 3-5 concurrent ‚ö° Zero-build CDN architecture ‚ö° Cyber goth neon aesthetics ‚ö° HTTP Range request support ‚ö° Glass morphism UI ‚ö° React 18 + Babel transpilation ‚ö° ES6 modules ‚ö° ')
          )
        ),
        // Download Status Component
        React.createElement(DownloadStatus),
        React.createElement('main', {
          className: 'compact-container',
          style: { maxWidth: '1200px', margin: '0 auto' }
        },
          videos.length === 0
            ? React.createElement('div', { style: { textAlign: 'center', padding: '3rem 1rem' } },
              React.createElement('h2', { style: { color: '#ffd93d' } }, 'No videos found'),
              React.createElement('p', null, 'Please add video files to the BRANDIFICATION folder')
            )
            : React.createElement('div', {
              style: {
                display: 'flex',
                gap: '1rem',
                alignItems: 'flex-start',
                flexWrap: 'wrap'
              }
            },
              // Left sidebar - Video selection
              videos.length > 1 && React.createElement('div', {
                className: 'glass-bubble glow-effect',
                style: {
                  flex: '0 0 280px',
                  padding: '1rem',
                  maxHeight: '80vh',
                  overflowY: 'auto',
                  position: 'sticky',
                  top: '1rem'
                }
              },
                React.createElement('h3', {
                  style: {
                    marginBottom: '1rem',
                    textAlign: 'center',
                    color: 'var(--nav-alt)',
                    fontSize: '1.1rem',
                    textShadow: '0 0 10px var(--glow-cyan)'
                  }
                }, 'üìÅ Select a video:'),
                React.createElement('div', {
                  className: 'no-spacing',
                  style: {
                    display: 'flex',
                    flexDirection: 'column',
                    gap: '0.5rem'
                  }
                },
                  videos.map(video =>
                    React.createElement('button', {
                      key: video.filename,
                      onClick: () => setSelectedVideo(video),
                      className: selectedVideo?.filename === video.filename ? 'bubble-button selected glow-effect' : 'bubble-button',
                      style: {
                        fontSize: '0.7rem',
                        display: 'flex',
                        flexDirection: 'column',
                        alignItems: 'flex-start',
                        gap: '0.2rem',
                        textAlign: 'left',
                        width: '100%'
                      }
                    }, 
                      React.createElement('span', {
                        style: {
                          wordBreak: 'break-word',
                          width: '100%'
                        }
                      }, video.filename),
                      React.createElement('span', {
                        style: {
                          fontSize: '0.6rem',
                          opacity: 0.7,
                          color: 'var(--primary-alt)'
                        }
                      }, `${video.sizeMB} MB`)
                    )
                  )
                )
              ),
              // Right content - Video player
              React.createElement('div', {
                style: {
                  flex: '1 1 600px',
                  minWidth: 0
                }
              },
                selectedVideo && React.createElement(VideoPlayer, {
                  videoSrc: `/videos/${selectedVideo.filename}?ticket=${ticketId}`,
                  title: selectedVideo.filename
                })
              )
            )
          ),
          React.createElement('footer', {
            className: 'glass-bubble compact-container',
            style: {
            textAlign: 'center',
            margin: '1rem auto',
            maxWidth: '1200px',
            fontSize: '0.9rem',
            lineHeight: '1.6',
            background: 'linear-gradient(135deg, rgba(12, 42, 42, 0.4), rgba(64, 0, 47, 0.4))',
            border: '2px solid rgba(23, 219, 216, 0.6)',
            boxShadow: '0 0 40px rgba(0, 255, 255, 0.4), 0 0 80px rgba(138, 43, 226, 0.3), inset 0 0 30px rgba(0, 255, 255, 0.15)',
            backdropFilter: 'blur(25px)'
          }
        },
          // Special Thanks section
          React.createElement('div', { 
            style: { 
              borderTop: '2px solid rgba(21, 170, 181, 0.5)',
              paddingTop: '1.5rem',
              marginBottom: '1.5rem',
              background: 'rgba(21, 170, 181, 0.05)',
              padding: '1.5rem 1rem',
              borderRadius: '12px'
            } 
          },
            React.createElement('p', { 
              style: { 
                fontSize: '1.1rem',
                marginBottom: '1rem',
                color: '#00FF7F',
                fontWeight: 'bold',
                textShadow: '0 0 15px #00FF00, 0 0 30px #7FFF00, 0 0 45px #00FFFF',
                letterSpacing: '1px'
              } 
            }, 'üôè Special Thanks To:'),
            React.createElement('div', { 
              style: { 
                display: 'flex',
                justifyContent: 'center',
                gap: '2rem',
                flexWrap: 'wrap'
              } 
            },
              React.createElement('a', {
                href: 'https://bambisleep.info',
                style: { 
                  color: 'var(--glow-purple)',
                  textDecoration: 'none',
                  fontSize: '0.9rem',
                  fontWeight: 'bold',
                  textShadow: '0 0 8px var(--glow-purple)',
                  transition: 'all 0.3s ease',
                  padding: '0.5rem 1rem',
                  border: '1px solid rgba(138, 43, 226, 0.5)',
                  borderRadius: '8px',
                  background: 'rgba(138, 43, 226, 0.1)'
                },
                target: '_blank',
                onMouseEnter: (e) => {
                  e.target.style.textShadow = '0 0 15px var(--glow-purple), 0 0 30px var(--glow-purple)';
                  e.target.style.background = 'rgba(138, 43, 226, 0.2)';
                },
                onMouseLeave: (e) => {
                  e.target.style.textShadow = '0 0 8px var(--glow-purple)';
                  e.target.style.background = 'rgba(138, 43, 226, 0.1)';
                }
              }, 'üìö BambiSleep Wiki'),
              React.createElement('a', {
                href: 'https://bambicloud.com',
                style: { 
                  color: 'var(--glow-cyan)',
                  textDecoration: 'none',
                  fontSize: '0.9rem',
                  fontWeight: 'bold',
                  textShadow: '0 0 8px var(--glow-cyan)',
                  transition: 'all 0.3s ease',
                  padding: '0.5rem 1rem',
                  border: '1px solid rgba(0, 255, 255, 0.5)',
                  borderRadius: '8px',
                  background: 'rgba(0, 255, 255, 0.1)'
                },
                target: '_blank',
                onMouseEnter: (e) => {
                  e.target.style.textShadow = '0 0 15px var(--glow-cyan), 0 0 30px var(--glow-cyan)';
                  e.target.style.background = 'rgba(0, 255, 255, 0.2)';
                },
                onMouseLeave: (e) => {
                  e.target.style.textShadow = '0 0 8px var(--glow-cyan)';
                  e.target.style.background = 'rgba(0, 255, 255, 0.1)';
                }
              }, '‚òÅÔ∏è Bambi Cloud')
            )
          ),
          
          // Main Projects section
          React.createElement('div', { 
            style: { 
              borderTop: '2px solid rgba(223, 4, 113, 0.5)',
              paddingTop: '1.5rem',
              background: 'rgba(223, 4, 113, 0.08)',
              padding: '1.5rem 1rem',
              borderRadius: '12px'
            } 
          },
            React.createElement('p', { 
              style: { 
                fontSize: '1.1rem',
                marginBottom: '1rem',
                color: '#FF1493',
                fontWeight: 'bold',
                textShadow: '0 0 15px #FF00FF, 0 0 30px #FF1493, 0 0 45px #FF69B4',
                letterSpacing: '1px'
              } 
            }, 'üöÄ Main Projects:'),
            React.createElement('div', { 
              style: { 
                display: 'flex',
                justifyContent: 'center',
                gap: '1.5rem',
                flexWrap: 'wrap',
                marginTop: '1rem'
              } 
            },
              React.createElement('a', {
                href: 'https://bambisleep.chat',
                style: { 
                  color: '#ffffff',
                  textDecoration: 'none',
                  fontSize: '0.85rem',
                  fontWeight: 'bold',
                  padding: '0.75rem 1.5rem',
                  background: 'linear-gradient(135deg, rgba(223, 4, 113, 0.3), rgba(255, 0, 255, 0.3))',
                  border: '2px solid var(--button-color)',
                  borderRadius: '12px',
                  boxShadow: '0 0 15px rgba(223, 4, 113, 0.5)',
                  textShadow: '0 0 8px var(--glow-pink)',
                  transition: 'all 0.3s ease',
                  display: 'inline-block'
                },
                target: '_blank',
                onMouseEnter: (e) => {
                  e.target.style.boxShadow = '0 0 25px rgba(223, 4, 113, 0.8), 0 0 50px rgba(255, 0, 255, 0.5)';
                  e.target.style.transform = 'translateY(-2px)';
                  e.target.style.textShadow = '0 0 15px var(--glow-pink), 0 0 30px var(--glow-pink)';
                },
                onMouseLeave: (e) => {
                  e.target.style.boxShadow = '0 0 15px rgba(223, 4, 113, 0.5)';
                  e.target.style.transform = 'translateY(0)';
                  e.target.style.textShadow = '0 0 8px var(--glow-pink)';
                }
              }, 'ü§ñ BambiSleep.Chat - AI Hypnotic Girlfriend ‚Ä¢ Mind Control ‚Ä¢ Programming ‚Ä¢ Transformation ‚Ä¢ NSFW'),
              React.createElement('a', {
                href: 'https://bambisleep.church',
                style: { 
                  color: '#ffffff',
                  textDecoration: 'none',
                  fontSize: '0.85rem',
                  fontWeight: 'bold',
                  padding: '0.75rem 1.5rem',
                  background: 'linear-gradient(135deg, rgba(138, 43, 226, 0.3), rgba(64, 0, 47, 0.3))',
                  border: '2px solid var(--glow-purple)',
                  borderRadius: '12px',
                  boxShadow: '0 0 15px rgba(138, 43, 226, 0.5)',
                  textShadow: '0 0 8px var(--glow-purple)',
                  transition: 'all 0.3s ease',
                  display: 'inline-block'
                },
                target: '_blank',
                onMouseEnter: (e) => {
                  e.target.style.boxShadow = '0 0 25px rgba(138, 43, 226, 0.8), 0 0 50px rgba(138, 43, 226, 0.5)';
                  e.target.style.transform = 'translateY(-2px)';
                  e.target.style.textShadow = '0 0 15px var(--glow-purple), 0 0 30px var(--glow-purple)';
                },
                onMouseLeave: (e) => {
                  e.target.style.boxShadow = '0 0 15px rgba(138, 43, 226, 0.5)';
                  e.target.style.transform = 'translateY(0)';
                  e.target.style.textShadow = '0 0 8px var(--glow-purple)';
                }
              }, '‚õ™ BambiSleep.Church - Digital Sanctuary')
            )
          )
        ),
        
        // Built with credit - bottom right corner
        React.createElement('div', {
          style: {
            position: 'fixed',
            bottom: '10px',
            right: '10px',
            padding: '0.5rem 0.75rem',
            background: 'rgba(0, 0, 0, 0.5)',
            borderRadius: '8px',
            border: '1px solid rgba(255, 215, 0, 0.3)',
            boxShadow: '0 0 15px rgba(255, 140, 0, 0.3)',
            backdropFilter: 'blur(10px)',
            fontSize: '0.7rem',
            zIndex: 1000
          }
        },
          React.createElement('p', {
            style: {
              margin: 0,
              color: '#FFD700',
              textShadow: '0 0 8px #FF8C00',
              fontWeight: 'bold'
            }
          }, 'üíñ Built with ‚ù§Ô∏è using Express & React'),
          React.createElement('p', {
            style: {
              margin: '0.25rem 0 0 0',
              fontSize: '0.65rem',
              color: '#ffffff',
              opacity: 0.8
            }
          },
            'By ', React.createElement('a', {
              href: 'https://github.com/HarleyVader',
              style: {
                color: 'var(--glow-pink)',
                textDecoration: 'none',
                fontWeight: 'bold',
                textShadow: '0 0 5px var(--glow-pink)'
              },
              target: '_blank'
            }, 'HarleyVader')
          )
        )
      );
    }
  
    // Add CSS animation for loading spinner
    const style = document.createElement('style');
    style.textContent = `
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `;
    document.head.appendChild(style);

    // React 18 createRoot API
    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(React.createElement(App));
  </script>
</body>

</html>